const express=require("express"),cors=require("cors"),bodyParser=require("body-parser"),fs=require("fs"),app=express(),port=3001,API_KEY="011ba11bdcad4fa396660c2ec447ef14";app.use(cors()),app.use(bodyParser.json());const checkApiKey=(e,r,t)=>{const s=e.headers["x-api-key"];if(!s||s!==API_KEY)return r.status(401).json({error:"Неверный API ключ"});t()};let certificates=[{id:1,name:"Сертификат на курсы по ит",price:5e4,description:"Description 1"},{id:2,name:"Сертификат на массаж",price:23e3,description:"Description 2"},{id:3,name:"Сертификат на курсы в автошколе",price:15e3,description:"Description 3"},{id:4,name:"Сертификат на курсы по кулинарии",price:12500,description:"Description 3"}],selectedCertificate=null,userData=null;app.get("/api/certificates",checkApiKey,((e,r)=>{r.json(certificates)})),app.get("/api/orders",checkApiKey,((e,r)=>{try{const e=selectedCertificate?{...selectedCertificate,userData}:null;r.json(e?[e]:[])}catch(e){console.error("Ошибка при получении заказа:",e),r.status(500).json({error:"Внутренняя ошибка сервера"})}})),app.post("/api/orders",checkApiKey,((e,r)=>{try{const{certificateId:t,price:s,userData:i}=e.body,c=certificates.find((e=>e.id===t));if(!c)return r.status(404).json({error:"Сертификат не найден"});if(c.price!==s)return r.status(400).json({error:"Некорректная цена сертификата"});selectedCertificate={id:1,certificateId:t,price:s,date:(new Date).toISOString()},i&&(userData={name:i.name,phone:i.phone,email:i.email}),r.status(201).json({...selectedCertificate,userData})}catch(e){console.error("Ошибка при создании заказа:",e),r.status(500).json({error:"Внутренняя ошибка сервера"})}})),app.listen(3001,(()=>{console.log("Сервер запущен на порту 3001")}));